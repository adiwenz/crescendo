import '../models/exercise_category.dart';
import '../models/pitch_highway_spec.dart';
import '../models/pitch_segment.dart';
import '../models/vocal_exercise.dart';

const _seedDate = 1704067200000; // 2024-01-01 UTC

List<ExerciseCategory> seedExerciseCategories() => const [
      ExerciseCategory(
        id: 'breathing_support',
        title: 'Breathing & Support',
        description: 'Build steady airflow and efficient support habits.',
        sortOrder: 1,
        iconKey: 'breath',
      ),
      ExerciseCategory(
        id: 'sovt',
        title: 'SOVT',
        description:
            'Semi-Occluded Vocal Tract. Reduce tension and balance airflow with occlusion.',
        sortOrder: 2,
        iconKey: 'sovt',
      ),
      ExerciseCategory(
        id: 'onset_release',
        title: 'Onset & Release',
        description: 'Train clean starts and relaxed releases.',
        sortOrder: 3,
        iconKey: 'onset',
      ),
      ExerciseCategory(
        id: 'resonance_placement',
        title: 'Resonance & Placement',
        description: 'Find forward resonance and reduce throat tension.',
        sortOrder: 4,
        iconKey: 'resonance',
      ),
      ExerciseCategory(
        id: 'range_building',
        title: 'Range Building',
        description: 'Connect registers while extending range.',
        sortOrder: 5,
        iconKey: 'range',
      ),
      ExerciseCategory(
        id: 'register_balance',
        title: 'Register Balance (Chest/Mix/Head)',
        description: 'Smooth transitions across registers.',
        sortOrder: 6,
        iconKey: 'register',
      ),
      ExerciseCategory(
        id: 'intonation',
        title: 'Intonation & Pitch Accuracy',
        description: 'Improve pitch memory and accuracy.',
        sortOrder: 8,
        iconKey: 'intonation',
      ),
      ExerciseCategory(
        id: 'agility_runs',
        title: 'Agility & Riffs/Runs',
        description: 'Build speed and coordination for runs.',
        sortOrder: 9,
        iconKey: 'agility',
      ),
    ];

List<VocalExercise> seedVocalExercises() {
  final createdAt = DateTime.fromMillisecondsSinceEpoch(_seedDate);
  const baseC4 = 60;
  const toleranceBeginner = 35.0;
  const toleranceIntermediate = 25.0;
  const toleranceAdvanced = 15.0;

  PitchHighwaySpec scaleSpec({
    required int baseMidi,
    required int noteMs,
    required double tolerance,
    List<String>? labels,
    List<int> pattern = const [0, 2, 4, 5, 7, 5, 4, 2, 0],
  }) {
    return PitchHighwaySpec(
      segments: _patternSegments(
        baseMidi: baseMidi,
        noteMs: noteMs,
        offsets: pattern,
        tolerance: tolerance,
        labels: labels,
      ),
    );
  }

  PitchHighwaySpec arpeggioSpec({
    required int baseMidi,
    required int noteMs,
    required double tolerance,
    List<String>? labels,
  }) {
    return PitchHighwaySpec(
      segments: _patternSegments(
        baseMidi: baseMidi,
        noteMs: noteMs,
        offsets: const [0, 4, 7, 12, 7, 4, 0],
        tolerance: tolerance,
        labels: labels,
      ),
    );
  }

  PitchHighwaySpec glideSpec({
    required int startMidi,
    required int endMidi,
    required int durationMs,
    required double tolerance,
    String? label,
  }) {
    return PitchHighwaySpec(
      segments: [
        PitchSegment(
          startMs: 0,
          endMs: durationMs,
          midiNote: startMidi,
          toleranceCents: tolerance,
          label: label,
          startMidi: startMidi,
          endMidi: endMidi,
        ),
      ],
    );
  }

  PitchHighwaySpec sirenSpec({
    required int startMidi,
    required int highMidi,
    required int durationMs,
    required double tolerance,
    String? label,
  }) {
    final half = (durationMs / 2).round();
    return PitchHighwaySpec(
      segments: [
        PitchSegment(
          startMs: 0,
          endMs: half,
          midiNote: startMidi,
          toleranceCents: tolerance,
          label: label,
          startMidi: startMidi,
          endMidi: highMidi,
        ),
        PitchSegment(
          startMs: half,
          endMs: durationMs,
          midiNote: highMidi,
          toleranceCents: tolerance,
          label: label,
          startMidi: highMidi,
          endMidi: startMidi,
        ),
      ],
    );
  }

  int _minutesFromSeconds(int? seconds, {int fallback = 2}) {
    if (seconds == null || seconds <= 0) return fallback;
    final mins = (seconds / 60).round();
    return mins.clamp(1, 60);
  }

  return [
    VocalExercise(
      id: 'appoggio_breathing',
      name: 'Appoggio Breathing',
      categoryId: 'breathing_support',
      type: ExerciseType.breathTimer,
      description:
          'Inhale by expanding ribs/back, then exhale steadily without collapse.',
      purpose: 'Build stable airflow and support coordination.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['support', 'breath', 'stability'],
      iconKey: 'breath',
      estimatedMinutes: _minutesFromSeconds(30),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'sustained_s_z',
      name: 'Sustained "S" or "Z"',
      categoryId: 'breathing_support',
      type: ExerciseType.breathTimer,
      description:
          'Sustain a long hiss or voiced buzz with consistent airflow.',
      purpose: 'Improve breath control and engagement.',
      durationSeconds: 30,
      reps: 6,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['support', 'breath', 'engagement'],
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'panting_breaths',
      name: 'Panting / Dog Breaths',
      categoryId: 'breathing_support',
      type: ExerciseType.breathTimer,
      description:
          'Short rhythmic breaths through the mouth with quick recovery.',
      purpose: 'Train a quick, responsive inhale reflex.',
      durationSeconds: 30,
      reps: 4,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['breath', 'stamina', 'support'],
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'inhale_suspend_exhale',
      name: 'Inhale–Suspend–Exhale',
      categoryId: 'breathing_support',
      type: ExerciseType.breathTimer,
      description: 'Inhale, suspend briefly, then release a controlled exhale.',
      purpose: 'Build control and avoid collapse after inhaling.',
      durationSeconds: 30,
      reps: 5,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['breath', 'control', 'support'],
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'lip_trills',
      name: 'Lip Trills',
      categoryId: 'sovt',
      type: ExerciseType.sovtTimer,
      description: 'Buzzy lip trill on steady airflow with relaxed lips.',
      purpose: 'Reduce tension and balance airflow.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['sovt', 'support', 'recovery'],
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'tongue_trills',
      name: 'Tongue Trills',
      categoryId: 'sovt',
      type: ExerciseType.sovtTimer,
      description: 'Roll an "R" while sustaining airflow and a relaxed tongue.',
      purpose: 'Release tongue tension and boost resonance.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['sovt', 'resonance', 'release'],
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'straw_phonation',
      name: 'Straw Phonation',
      categoryId: 'sovt',
      type: ExerciseType.sovtTimer,
      description: 'Phonate through a straw with gentle airflow.',
      purpose: 'Encourage efficient fold closure and balance.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['sovt', 'recovery', 'support'],
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'vv_zz_scales',
      name: '"VV" or "ZZ"',
      categoryId: 'sovt',
      type: ExerciseType.pitchHighway,
      description:
          'Voiced fricative scales on "vv" or "zz" with steady airflow.',
      purpose: 'Smooth onset and balanced closure.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['sovt', 'onset', 'support'],
      highwaySpec: scaleSpec(
        baseMidi: baseC4,
        noteMs: 450,
        tolerance: toleranceBeginner,
        labels: List.filled(9, 'VV/ZZ'),
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'humming_scales',
      name: 'Humming',
      categoryId: 'sovt',
      type: ExerciseType.pitchHighway,
      description: 'Gentle hum through a comfortable scale.',
      purpose: 'Encourage forward resonance and ease.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['sovt', 'resonance', 'recovery'],
      highwaySpec: scaleSpec(
        baseMidi: baseC4,
        noteMs: 500,
        tolerance: toleranceBeginner,
        labels: List.filled(9, 'Hum'),
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'balanced_onset',
      name: 'Balanced Onset ("Mmm", "Nnn")',
      categoryId: 'onset_release',
      type: ExerciseType.pitchHighway,
      description:
          'Use consonant-led onsets to coordinate breath and fold closure.',
      purpose: 'Train clean starts and balanced onset.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['onset', 'control', 'resonance'],
      highwaySpec: scaleSpec(
        baseMidi: baseC4,
        noteMs: 450,
        tolerance: toleranceBeginner,
        labels: List.filled(9, 'Mmm'),
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'aspirated_onset',
      name: 'Aspirated Onset ("Hah")',
      categoryId: 'onset_release',
      type: ExerciseType.pitchHighway,
      description: 'Breathy onset to release excessive pressure.',
      purpose: 'Reduce pressed onset and encourage flow.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['onset', 'release', 'support'],
      highwaySpec: scaleSpec(
        baseMidi: baseC4,
        noteMs: 450,
        tolerance: toleranceBeginner,
        labels: List.filled(9, 'Hah'),
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'ng_slides',
      name: 'NG Slides',
      categoryId: 'resonance_placement',
      type: ExerciseType.pitchHighway,
      description: 'Siren on "ng" to keep sound forward.',
      purpose: 'Build forward resonance and reduce throat tension.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['resonance', 'placement', 'release'],
      highwaySpec: glideSpec(
        startMidi: 60,
        endMidi: 72,
        durationMs: 4000,
        tolerance: toleranceBeginner,
        label: 'NG',
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'yawn_sigh',
      name: 'Yawn–Sigh',
      categoryId: 'resonance_placement',
      type: ExerciseType.pitchHighway,
      description: 'Open the pharynx and descend gently in a sigh.',
      purpose: 'Release constriction and soften the throat.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['release', 'resonance', 'recovery'],
      highwaySpec: glideSpec(
        startMidi: 67,
        endMidi: 55,
        durationMs: 4000,
        tolerance: toleranceBeginner,
        label: 'Sigh',
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'forward_placement',
      name: 'Forward Placement ("Nay", "Nee")',
      categoryId: 'resonance_placement',
      type: ExerciseType.pitchHighway,
      description: 'Brighter vowels to focus sound forward.',
      purpose: 'Improve clarity and resonance focus.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.intermediate,
      tags: const ['resonance', 'placement', 'clarity'],
      highwaySpec: scaleSpec(
        baseMidi: baseC4,
        noteMs: 420,
        tolerance: toleranceIntermediate,
        labels: List.filled(9, 'Nay/Nee'),
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'mask_resonance',
      name: 'Mask Resonance Buzz',
      categoryId: 'resonance_placement',
      type: ExerciseType.pitchHighway,
      description: 'Buzz forward to feel vibration in the mask.',
      purpose: 'Encourage efficient resonance.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['resonance', 'placement', 'support'],
      highwaySpec: scaleSpec(
        baseMidi: baseC4,
        noteMs: 500,
        tolerance: toleranceBeginner,
        labels: List.filled(9, 'Buzz'),
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'sirens',
      name: 'Sirens',
      categoryId: 'range_building',
      type: ExerciseType.pitchHighway,
      description: 'Slide low→high→low with a smooth siren.',
      purpose: 'Connect registers smoothly.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.intermediate,
      tags: const ['range', 'mix', 'transition'],
      highwaySpec: sirenSpec(
        startMidi: 55,
        highMidi: 72,
        durationMs: 5000,
        tolerance: toleranceIntermediate,
        label: 'Siren',
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'five_tone_scales',
      name: '5-Tone Scales',
      categoryId: 'range_building',
      type: ExerciseType.pitchHighway,
      description: '1-2-3-4-5 patterns for controlled extension.',
      purpose: 'Build consistent tone while extending range.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['range', 'support', 'pitch'],
      highwaySpec: scaleSpec(
        baseMidi: baseC4,
        noteMs: 400,
        tolerance: toleranceBeginner,
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'octave_slides',
      name: 'Octave Slides',
      categoryId: 'range_building',
      type: ExerciseType.pitchHighway,
      description: 'Slide from root to octave with steady airflow.',
      purpose: 'Bridge range smoothly.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.intermediate,
      tags: const ['range', 'transition', 'support'],
      highwaySpec: glideSpec(
        startMidi: baseC4,
        endMidi: baseC4 + 12,
        durationMs: 3500,
        tolerance: toleranceIntermediate,
        label: 'Octave',
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'arpeggios',
      name: 'Arpeggios (1–3–5–8)',
      categoryId: 'range_building',
      type: ExerciseType.pitchHighway,
      description: 'Chord tone patterns to clarify top and bottom.',
      purpose: 'Strengthen pitch clarity across the range.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.intermediate,
      tags: const ['range', 'pitch', 'clarity'],
      highwaySpec: arpeggioSpec(
        baseMidi: baseC4,
        noteMs: 420,
        tolerance: toleranceIntermediate,
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'chest_voice_scales',
      name: 'Chest Voice Scales',
      categoryId: 'register_balance',
      type: ExerciseType.pitchHighway,
      description: 'Lower range scales with grounded tone.',
      purpose: 'Strengthen chest register.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['chest', 'support', 'register'],
      highwaySpec: scaleSpec(
        baseMidi: 55,
        noteMs: 500,
        tolerance: toleranceBeginner,
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'head_voice_scales',
      name: 'Head Voice Scales',
      categoryId: 'register_balance',
      type: ExerciseType.pitchHighway,
      description: 'Light, easy scales above the passaggio.',
      purpose: 'Ease into head voice without strain.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.intermediate,
      tags: const ['head', 'register', 'ease'],
      highwaySpec: scaleSpec(
        baseMidi: 67,
        noteMs: 450,
        tolerance: toleranceIntermediate,
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'mix_bridging',
      name: 'Mix Bridging ("Gee", "Nay")',
      categoryId: 'register_balance',
      type: ExerciseType.pitchHighway,
      description: 'Travel through midrange with focused syllables.',
      purpose: 'Smooth transitions between chest and head.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.intermediate,
      tags: const ['mix', 'transition', 'resonance'],
      highwaySpec: arpeggioSpec(
        baseMidi: baseC4,
        noteMs: 430,
        tolerance: toleranceIntermediate,
        labels: List.filled(7, 'Gee/Nay'),
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'descending_head_to_chest',
      name: 'Descending Head→Chest',
      categoryId: 'register_balance',
      type: ExerciseType.pitchHighway,
      description: 'Start high and descend without dropping weight.',
      purpose: 'Blend registers while descending.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.intermediate,
      tags: const ['blend', 'register', 'transition'],
      highwaySpec: scaleSpec(
        baseMidi: 60,
        noteMs: 420,
        tolerance: toleranceIntermediate,
        pattern: const [12, 11, 9, 7, 5, 4, 2, 0],
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'sustained_pitch_holds',
      name: 'Sustained Pitch Holds',
      categoryId: 'intonation',
      type: ExerciseType.sustainedPitchHold,
      description: 'Hold a target pitch with a live cents meter.',
      purpose: 'Improve pitch stability.',
      durationSeconds: 30,
      reps: 6,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['pitch', 'stability', 'intonation'],
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'interval_training',
      name: 'Interval Training',
      categoryId: 'intonation',
      type: ExerciseType.pitchMatchListening,
      description: 'Sing intervals after hearing reference tones.',
      purpose: 'Build relative pitch awareness.',
      durationSeconds: 30,
      reps: 8,
      difficulty: ExerciseDifficulty.intermediate,
      tags: const ['pitch', 'ear', 'intervals'],
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'call_response_matching',
      name: 'Call-and-Response Pitch Matching',
      categoryId: 'intonation',
      type: ExerciseType.pitchMatchListening,
      description: 'Echo short note patterns after hearing them.',
      purpose: 'Strengthen ear–voice coordination.',
      durationSeconds: 30,
      reps: 8,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['pitch', 'ear', 'match'],
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'scale_degrees',
      name: 'Scale Degrees (Do–Re–Mi)',
      categoryId: 'intonation',
      type: ExerciseType.pitchHighway,
      description: 'Sing solfege degrees with clear pitch targets.',
      purpose: 'Build tonal awareness and accuracy.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.beginner,
      tags: const ['pitch', 'solfege', 'intonation'],
      highwaySpec: scaleSpec(
        baseMidi: baseC4,
        noteMs: 420,
        tolerance: toleranceBeginner,
        labels: const ['Do', 'Re', 'Mi', 'Fa', 'Sol', 'Fa', 'Mi', 'Re', 'Do'],
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'fast_three_note_patterns',
      name: 'Fast 3-Note Patterns',
      categoryId: 'agility_runs',
      type: ExerciseType.pitchHighway,
      description: 'Quick 1-2-3 patterns for coordination.',
      purpose: 'Improve agility for runs.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.intermediate,
      tags: const ['agility', 'runs', 'coordination'],
      highwaySpec: scaleSpec(
        baseMidi: baseC4,
        noteMs: 180,
        tolerance: toleranceIntermediate,
        pattern: const [0, 2, 4, 2, 0, 2, 4, 2, 0],
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'melismatic_scales',
      name: 'Melismatic Scales',
      categoryId: 'agility_runs',
      type: ExerciseType.pitchHighway,
      description: 'Multiple notes per syllable for flexibility.',
      purpose: 'Develop smooth melismatic movement.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.intermediate,
      tags: const ['agility', 'runs', 'flexibility'],
      highwaySpec: scaleSpec(
        baseMidi: baseC4,
        noteMs: 260,
        tolerance: toleranceIntermediate,
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'staccato_bursts',
      name: 'Staccato Bursts',
      categoryId: 'agility_runs',
      type: ExerciseType.pitchHighway,
      description: 'Short detached notes to clean articulation.',
      purpose: 'Improve precision and coordination.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.intermediate,
      tags: const ['agility', 'articulation', 'precision'],
      highwaySpec: scaleSpec(
        baseMidi: baseC4,
        noteMs: 160,
        tolerance: toleranceIntermediate,
        pattern: const [0, 0, 0, 2, 2, 2, 4, 4, 4],
      ),
      createdAt: createdAt,
    ),
    VocalExercise(
      id: 'descending_runs',
      name: 'Descending Runs',
      categoryId: 'agility_runs',
      type: ExerciseType.pitchHighway,
      description: 'Fast high→low runs to release tension.',
      purpose: 'Encourage speed without tightening.',
      durationSeconds: 30,
      difficulty: ExerciseDifficulty.advanced,
      tags: const ['agility', 'runs', 'release'],
      highwaySpec: scaleSpec(
        baseMidi: baseC4,
        noteMs: 200,
        tolerance: toleranceAdvanced,
        pattern: const [12, 11, 9, 7, 5, 4, 2, 0],
      ),
      createdAt: createdAt,
    ),
  ];
}

List<PitchSegment> _patternSegments({
  required int baseMidi,
  required int noteMs,
  required List<int> offsets,
  required double tolerance,
  List<String>? labels,
}) {
  final segments = <PitchSegment>[];
  var cursor = 0;
  for (var i = 0; i < offsets.length; i++) {
    final label = labels != null && i < labels.length ? labels[i] : null;
    segments.add(PitchSegment(
      startMs: cursor,
      endMs: cursor + noteMs,
      midiNote: baseMidi + offsets[i],
      toleranceCents: tolerance,
      label: label,
    ));
    cursor += noteMs;
  }
  return segments;
}
